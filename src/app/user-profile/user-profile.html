<div [attr.data-theme]="isDarkMode() ? 'dark' : null">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar-placeholder">
                <div class="avatar-circle">
                    {{ userInitials() }}
                </div>
            </div>
            <div class="profile-info">
                <h1 class="profile-title">{{ userDisplayName() || 'User Profile' }}</h1>
                <p class="profile-subtitle">Manage your personal information</p>
                @if (currentUser()) {
                <p class="profile-email">{{ currentUser()?.email }}</p>
                }
            </div>
        </div>

        <form [formGroup]="Person" (ngSubmit)="onSubmit()" class="profile-form">
            <div class="form-sections">
                <!-- Personal Information Section -->
                <section class="form-section">
                    <h2 class="section-title">Personal Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="firstName" class="form-label">First Name</label>
                            <input id="firstName" formControlName="firstName" class="form-input"
                                placeholder="Enter your first name" type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('firstName')?.invalid && Person.get('firstName')?.touched">
                                First name is required
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input id="lastName" formControlName="lastName" class="form-input"
                                placeholder="Enter your last name" type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('lastName')?.invalid && Person.get('lastName')?.touched">
                                Last name is required
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="dateOfBirth" class="form-label">Date of Birth</label>
                            <input id="dateOfBirth" formControlName="dateOfBirth" class="form-input" type="date" />
                            <div class="input-error"
                                *ngIf="Person.get('dateOfBirth')?.invalid && Person.get('dateOfBirth')?.touched">
                                Please enter a valid date of birth
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Contact Information Section -->
                <section class="form-section">
                    <h2 class="section-title">Contact Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input id="phone" formControlName="phone" class="form-input" placeholder="(555) 123-4567"
                                type="tel" />
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Email Address:</label>
                            <input id="email" formControlName="email" class="form-input" type="email" />
                        </div>
                    </div>
                </section>

                <!-- Shipping Address Section -->
                <section class="form-section">
                    <h2 class="section-title">Shipping Address</h2>
                    <div class="form-grid" [formGroup]="$any(Person.get('address'))">
                        <div class="form-group full-width">
                            <label for="addressLine1" class="form-label">Address Line 1</label>
                            <input id="addressLine1" formControlName="addressLine1" class="form-input"
                                placeholder="123 Main Street" type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('address')?.get('addressLine1')?.invalid && Person.get('address')?.get('addressLine1')?.touched">
                                Address Line 1 is required
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="addressLine2" class="form-label">Address Line 2 (Optional)</label>
                            <input id="addressLine2" formControlName="addressLine2" class="form-input"
                                placeholder="Apt, Suite, Unit, Building, Floor, etc." type="text" />
                        </div>

                        <div class="form-group">
                            <label for="city" class="form-label">City</label>
                            <input id="city" formControlName="city" class="form-input" placeholder="New York"
                                type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('address')?.get('city')?.invalid && Person.get('address')?.get('city')?.touched">
                                City is required
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="state" class="form-label">State/Province</label>
                            <input id="state" formControlName="state" class="form-input" placeholder="NY" type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('address')?.get('state')?.invalid && Person.get('address')?.get('state')?.touched">
                                State is required
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="postalCode" class="form-label">Postal Code</label>
                            <input id="postalCode" formControlName="postalCode" class="form-input" placeholder="10001"
                                type="text" />
                            <div class="input-error"
                                *ngIf="Person.get('address')?.get('postalCode')?.invalid && Person.get('address')?.get('postalCode')?.touched">
                                Postal code is required
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="country" class="form-label">Country</label>
                            <select id="country" formControlName="country" class="form-input">
                                <option value="USA">United States</option>
                                <option value="CAN">Canada</option>
                                <option value="MEX">Mexico</option>
                                <option value="GBR">United Kingdom</option>
                                <option value="FRA">France</option>
                                <option value="DEU">Germany</option>
                                <option value="ITA">Italy</option>
                                <option value="ESP">Spain</option>
                                <option value="AUS">Australia</option>
                                <option value="JPN">Japan</option>
                                <option value="CHN">China</option>
                                <option value="IND">India</option>
                                <option value="BRA">Brazil</option>
                            </select>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Payment Methods Section -->
            <section class="form-section">
                <div class="section-header">
                    <h2 class="section-title">Payment Methods</h2>
                    <button type="button" class="btn btn-primary" (click)="openPaymentModal()">
                        <span class="btn-icon">💳</span>
                        Add Payment Method
                    </button>
                </div>

                <div class="payment-methods-list">
                    @if (paymentMethods().length === 0) {
                    <div class="no-payment-methods">
                        <p>No payment methods added yet. Click "Add Payment Method" to get started.</p>
                    </div>
                    } @else {
                    @for (method of paymentMethods(); track method.paymentId) {
                    <div class="payment-method-card">
                        <div class="payment-method-info">
                            <span class="card-type">💳</span>
                            <div class="card-details">
                                <div class="card-name">{{ method.nameOnCard }}</div>
                                <div class="card-number">**** **** **** {{ method.cardNumber.slice(-4) }}</div>
                                <div class="card-expiry">{{ method.cardExpirationMonth }}/{{ method.cardExpirationYear
                                    }}</div>
                                <div class="card-address">
                                    <span class="address-line">{{ method.addressLine1 }}</span>
                                    @if (method.addressLine2) {
                                    <span class="address-line">{{ method.addressLine2 }}</span>
                                    }
                                    <span class="address-line">{{ method.city }}, {{ method.state }} {{ method.zipCode
                                        }}</span>
                                    <span class="address-country">{{ method.country }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="payment-method-actions">
                            <button type="button" class="btn-icon-small btn-danger"
                                (click)="deletePaymentMethod(method.paymentId!)" title="Delete payment method">
                                🗑️
                            </button>
                        </div>
                    </div>
                    }
                    }
                </div>
            </section>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" (click)="onCancel()" class="btn-secondary">Cancel</button>
                <button type="submit" [disabled]="Person.invalid" class="btn-primary">Save Changes</button>
            </div>
        </form>

        <!-- Payment Method Modal -->
        @if (showPaymentModal()) {
        <app-add-payment-method (closeModal)="closePaymentModal()" (paymentMethodAdded)="onPaymentMethodAdded()">
        </app-add-payment-method>
        }
    </div>
</div>